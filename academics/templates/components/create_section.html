<!-- ปุ่ม -->
<a href="#" id="openModal"
   class="px-3 py-1.5 w-fit rounded-lg bg-orange-500 text-sm text-white hover:bg-orange-600">
  Create Section
</a>

<!-- Overlay -->
<div id="studentModal" 
     class="fixed inset-0 {% if not is_invalid %}hidden{% endif %} bg-black/50 bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white w-full max-w-lg rounded-2xl shadow-lg p-6 relative">
    <!-- ปุ่มปิด -->
    <button id="closeModal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">✕</button>

    <h2 class="text-2xl font-bold text-orange-500 mb-4">Create Section</h2>

    <form method="POST" action="" class="flex flex-col gap-4">
      {% csrf_token %}
        {{form.non_field_errors}}
        <div class="relative">
          <label for="{{form.course.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Course</label>
          {{form.course}}
          {{form.course.errors}}
        </div>

        <div class="relative">
          <label for="{{form.section_number.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Section Number</label>
          {{form.section_number}}
          {{form.section_number.errors}}
        </div>
        
        <div class="flex gap-4">
          <div class="relative flex-1">
            <label for="{{form.professor.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Professor</label>
            {{form.professor}}
            {{form.professor.errors}}
          </div>

          <div class="relative flex-1">
            <label for="{{form.class_type.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Class Type</label>
            {{form.class_type}}
            {{form.class_type.errors}}
          </div>
        </div>

        <div class="flex gap-4">
          <div class="relative flex-1">
            <label for="{{form.day.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Day</label>
            {{form.day}}
            {{form.day.err.errors}}
          </div>

          <div class="relative flex-1">
            <label for="{{form.start_time.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Start Time</label>
            {{form.start_time}}
            {{form.start_time.errors}}
          </div>

          <div class="relative flex-1">
            <label for="{{form.end_time.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">End Time</label>
            {{form.end_time}}
            {{form.end_time.errors}}
          </div>
        </div>

        <div class="flex gap-4">
          <div class="relative flex-1">
            <label for="{{form.location.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Location</label>
            {{form.location}}
            {{form.location.errors}}
          </div>

          <div class="relative flex-1">
            <label for="{{form.capacity.id_for_label}}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Capacity</label>
            {{form.capacity}}
            {{form.capacity.errors}}
          </div>
        </div>
      
      <div class="flex justify-end gap-2">
        <button type="button" id="cancelModal"
                class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">
          Cancel
        </button>
        <button type="submit" 
                class="px-4 py-2 rounded-lg bg-orange-500 text-white hover:bg-orange-600">
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  const modal = document.getElementById("studentModal");
  const openBtn = document.getElementById("openModal");
  const closeBtn = document.getElementById("closeModal");
  const cancelBtn = document.getElementById("cancelModal");

  openBtn.addEventListener("click", (e) => {
    e.preventDefault();
    modal.classList.remove("hidden");
    document.body.style.overflow = "hidden"; // ปิด scroll หน้าเว็บ
  });

  [closeBtn, cancelBtn].forEach(btn => {
    btn.addEventListener("click", () => {
      modal.classList.add("hidden");
      document.body.style.overflow = "auto"; // เปิด scroll หน้าเว็บ
    });
  });

  document.addEventListener("DOMContentLoaded", function() {
    const courseSelect = document.getElementById("id_course");
    const professorSelect = document.getElementById("id_professor");

    courseSelect.addEventListener("change", function() {
        const courseId = this.value;
        if (!courseId) return;

        fetch(`{% url 'get_professors' %}?course_id=${courseId}`)
            .then(response => response.json())
            .then(data => {
                professorSelect.innerHTML = '<option value="">---------</option>'; // reset
                data.forEach(prof => {
                    const option = document.createElement("option");
                    option.value = prof.id;
                    option.textContent = prof.name;
                    professorSelect.appendChild(option);
                });
            });
        });
  });
</script>
