{%extends 'base.html'%}

{%block title%}Change Password{%endblock%}

{%block content%}
<main class="w-full max-w-md">
  <section class="bg-white shadow-md rounded-2xl p-8">
    <div class="text-center">
      <h1 class="text-2xl font-semibold">แก้ไขรหัสผ่าน</h1>
      <p class="text-sm text-gray-500">คุณลงชื่อเข้าใช้ครั้งแรก โปรดเปลี่ยนรหัสผ่าน</p>
    </div><br>

    <form method="post" action="{% url 'change_password_view' %}">
      {% csrf_token %}
      <div>
        <label for="{{form.password.id_for_label}}" class="block text-sm font-medium text-gray-700">Password</label>
        <div class="mt-1 relative">
          {{form.password}}
          <button type="button" id="togglePassword" aria-label="show password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-gray-500">แสดง</button>
        </div>
      </div><br>

      <div>
        <label for="{{form.confirmed_password.id_for_label}}" class="block text-sm font-medium text-gray-700">Confirm Password</label>
        <div class="mt-1 relative">
          {{form.confirmed_password}}
          <button type="button" id="toggleConfirmedPassword" aria-label="show password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-gray-500">แสดง</button>
        </div>
      </div><br>
      {{form.non_field_errors}}

      <div>
        <button type="submit" class="w-full inline-flex items-center justify-center gap-2 rounded-lg bg-indigo-600 text-white font-medium py-3 px-4 shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
          ยืนยัน
        </button>
      </div>
      
    </form>
  </section>
</main>

<script>
  // ซ่อน/แสดง รหัสผ่าน
  const pw = document.getElementById('password');
  const toggle = document.getElementById('togglePassword');
  toggle?.addEventListener('click', () => {
    if (!pw) return;
      if (pw.type === 'password') {
        pw.type = 'text';
        toggle.textContent = 'ซ่อน';
      } else {
        pw.type = 'password';
        toggle.textContent = 'แสดง';
      }
  });

  const pw2 = document.getElementById('confirmed_password');
  const toggle2 = document.getElementById('toggleConfirmedPassword');
  toggle2?.addEventListener('click', () => {
    if (!pw2) return;
      if (pw2.type === 'password') {
        pw2.type = 'text';
        toggle2.textContent = 'ซ่อน';
      } else {
        pw2.type = 'password';
        toggle2.textContent = 'แสดง';
      }
  });

  // ป้องกันรหัสซ้ำฝั่ง frontend
  document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirmed_password = document.getElementById('confirmed_password').value;

    if (password !== confirmed_password) {
        e.preventDefault(); // ป้องกัน form submit
        alert("Passwords do not match!"); // แสดงข้อความแจ้งเตือน
        return false;
    }
});
</script>
{%endblock%}
